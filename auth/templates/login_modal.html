<!-- auth/templates/auth/login_modal.html - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->

<!-- –ü–†–û–í–ï–†–ö–ê: –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ -->
<script>
    (function() {
        var currentPath = window.location.pathname;
        var isAdminPage = currentPath.includes('/users/create-admin/') ||
                          currentPath.includes('create-admin');

        if (isAdminPage) {
            console.log('üö´ Login modal –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù –Ω–∞ admin creation page:', currentPath);
            document.addEventListener('DOMContentLoaded', function() {
                var loginModal = document.getElementById('authLoginModal');
                var backdrop = document.querySelectorAll('.modal-backdrop');

                if (loginModal) {
                    loginModal.remove();
                    console.log('üóëÔ∏è Login modal —É–¥–∞–ª–µ–Ω –∏–∑ DOM');
                }

                backdrop.forEach(function(el) {
                    if (el.previousElementSibling &&
                        el.previousElementSibling.id === 'authLoginModal') {
                        el.remove();
                        console.log('üóëÔ∏è Login modal backdrop —É–¥–∞–ª–µ–Ω');
                    }
                });
            });
            return;
        }

        console.log('‚úÖ Login modal —Ä–∞–∑—Ä–µ—à–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', currentPath);
    })();
</script>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
<div class="modal fade" id="authLoginModal" tabindex="-1" aria-labelledby="authLoginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content auth-modal-content">
            <div class="modal-header auth-modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="bi bi-shield-lock"></i>
                    </div>
                    <div class="header-text">
                        <h5 class="modal-title" id="authLoginModalLabel">
                            Systemanmeldung
                        </h5>
                        <p class="modal-subtitle">
                            Geben Sie Ihre Anmeldedaten ein
                        </p>
                    </div>
                </div>
            </div>

            <div class="modal-body auth-modal-body">

                <!-- System Info Alert -->
                <div class="alert alert-info auth-alert" role="alert">
                    <i class="bi bi-info-circle me-2"></i>
                    <div>
                        <strong>System bereit f√ºr Anmeldung</strong>
                        <br>
                        <small class="text-muted">
                            MongoDB verbunden ‚Ä¢ {{ admin_count|default:0 }} Administrator{{ admin_count|pluralize:"en" }} verf√ºgbar
                        </small>
                    </div>
                </div>

                <!-- Login Form -->
                <form method="post" id="authLoginForm" action="{% url 'auth:login' %}" novalidate>
                    {% csrf_token %}

                    <div class="row">
                        <div class="col-md-6">
                            <!-- Username Field -->
                            <div class="form-group mb-3">
                                <label for="authUsername" class="form-label">
                                    <i class="bi bi-person me-1"></i>
                                    Benutzername
                                </label>
                                <div class="input-icon-wrapper">
                                    <i class="bi bi-person-circle input-icon"></i>
                                    <input type="text"
                                           class="form-control"
                                           id="authUsername"
                                           name="username"
                                           placeholder="Benutzername eingeben"
                                           required
                                           autocomplete="username"
                                           autofocus>
                                </div>
                                <div class="invalid-feedback"></div>
                            </div>

                            <!-- Password Field -->
                            <div class="form-group mb-3">
                                <label for="authPassword" class="form-label">
                                    <i class="bi bi-key me-1"></i>
                                    Passwort
                                </label>
                                <div class="input-icon-wrapper">
                                    <i class="bi bi-shield-lock input-icon"></i>
                                    <input type="password"
                                           class="form-control"
                                           id="authPassword"
                                           name="password"
                                           placeholder="Passwort eingeben"
                                           required
                                           autocomplete="current-password">
                                    <button class="btn btn-icon-toggle"
                                            type="button"
                                            id="authTogglePassword"
                                            title="Passwort anzeigen/verbergen">
                                        <i class="bi bi-eye" id="authPasswordIcon"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback"></div>
                            </div>

                            <!-- Remember Me -->
                            <div class="form-check mb-3">
                                <input type="checkbox"
                                       class="form-check-input"
                                       id="authRememberMe"
                                       name="remember_me">
                                <label class="form-check-label" for="authRememberMe">
                                    Angemeldet bleiben
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <!-- Security Info -->
                            <div class="security-card">
                                <div class="security-header">
                                    <i class="bi bi-shield-check text-success"></i>
                                    <h6>Sicherheitsinformationen</h6>
                                </div>
                                <ul class="security-list">
                                    <li>
                                        <i class="bi bi-check-circle text-success"></i>
                                        Verschl√ºsselte Verbindung
                                    </li>
                                    <li>
                                        <i class="bi bi-check-circle text-success"></i>
                                        Sichere Authentifizierung
                                    </li>
                                    <li>
                                        <i class="bi bi-check-circle text-success"></i>
                                        Sitzungsverwaltung
                                    </li>
                                    <li>
                                        <i class="bi bi-info-circle text-primary"></i>
                                        Nach 5 Fehlversuchen: 15 Min. Sperre
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Attempts Warning -->
                    <div class="alert alert-warning attempts-warning" id="authAttemptsAlert" style="display: none;">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <span id="authAttemptsText"></span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="modal-footer auth-modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" id="authCancelBtn">
                            <i class="bi bi-x-circle me-1"></i>
                            Abbrechen
                        </button>
                        <button type="submit" class="btn btn-primary" id="authSubmitBtn">
                            <i class="bi bi-box-arrow-in-right me-1"></i>
                            <span id="authButtonText">Anmelden</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Loader –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
<div class="auth-modal-loader" id="authModalLoader">
    <div class="loader-content">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">L√§dt...</span>
        </div>
        <p class="mt-3 text-white">Anmeldung wird verarbeitet...</p>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
<link rel="stylesheet" href="{% static 'css/login_modal.css' %}">
<script src="{% static 'js/login_modal.js' %}"></script>