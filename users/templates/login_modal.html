<!-- users/templates/login_modal.html - Модальное окно аутентификации -->

<!-- Модальное окно входа -->
<div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Заголовок модального окна -->
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">
                    <i class="bi bi-shield-lock"></i>
                    Systemzugang erforderlich
                </h5>
                <!-- Кнопка закрытия скрыта для обязательной аутентификации -->
                <!-- <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button> -->
            </div>

            <!-- Тело модального окна -->
            <div class="modal-body">
                <!-- Уведомление о безопасности -->
                <div class="login-security-notice">
                    <i class="bi bi-info-circle"></i>
                    <div class="notice-content">
                        <strong>Authentifizierung erforderlich</strong>
                        <small>
                            Das System ist konfiguriert und bereit. Bitte melden Sie sich mit Ihren Administrator-Zugangsdaten an, um fortzufahren.
                        </small>
                    </div>
                </div>

                <!-- Системная информация -->
                <div class="login-system-info">
                    <div class="system-status">
                        <i class="bi bi-check-circle"></i>
                        <span>System bereit</span>
                    </div>
                    <div class="system-details">
                        MongoDB verbunden • Administratoren vorhanden • Sichere Verbindung aktiv
                    </div>
                </div>

                <!-- Форма входа -->
                <form id="loginForm" method="post" action="{% url 'users:login' %}" class="login-form">
                    {% csrf_token %}

                    <!-- Поле имени пользователя -->
                    <div class="form-floating mb-3">
                        <input type="text"
                               class="form-control with-icon"
                               id="id_username"
                               name="username"
                               placeholder="Benutzername"
                               autocomplete="username"
                               required>
                        <label for="id_username">
                            <i class="bi bi-person me-2"></i>
                            Benutzername
                        </label>
                        <div class="input-icon">
                            <i class="bi bi-person"></i>
                        </div>
                    </div>

                    <!-- Поле пароля -->
                    <div class="form-floating mb-3">
                        <input type="password"
                               class="form-control with-icon"
                               id="id_password"
                               name="password"
                               placeholder="Passwort"
                               autocomplete="current-password"
                               required>
                        <label for="id_password">
                            <i class="bi bi-key me-2"></i>
                            Passwort
                        </label>
                        <div class="input-icon">
                            <i class="bi bi-key"></i>
                        </div>
                    </div>

                    <!-- Запомнить меня -->
                    <div class="form-check mb-3">
                        <input type="checkbox"
                               class="form-check-input"
                               id="id_remember_me"
                               name="remember_me">
                        <label class="form-check-label" for="id_remember_me">
                            Angemeldet bleiben
                        </label>
                    </div>

                    <!-- Информация о попытках входа -->
                    <div class="attempts-info text-center small mb-3" style="display: none;">
                        <!-- Заполняется JavaScript -->
                    </div>

                    <!-- Кнопка входа -->
                    <button type="submit" class="btn btn-login" id="loginSubmitBtn">
                        <i class="bi bi-box-arrow-in-right me-2"></i>
                        Anmelden
                    </button>

                    <!-- Дополнительные ссылки (опционально) -->
                    <div class="login-links">
                        <a href="#" class="forgot-password" onclick="showForgotPasswordModal(); return false;">
                            Passwort vergessen?
                        </a>
                        <span class="link-separator">•</span>
                        <a href="#" class="system-help" onclick="showSystemHelp(); return false;">
                            Systemhilfe
                        </a>
                    </div>
                </form>

                <!-- Индикатор загрузки -->
                <div class="login-loader">
                    <div class="spinner"></div>
                    <div class="loading-text">Anmeldung läuft...</div>
                </div>
            </div>

            <!-- Футер модального окна -->
            <div class="modal-footer">
                <small class="text-muted w-100 text-center">
                    <i class="bi bi-shield-check me-1"></i>
                    Sichere Verbindung • WWS1 {{ system_version|default:"1.0" }}
                    <span class="d-block mt-1">
                        <i class="bi bi-info-circle me-1"></i>
                        Bei Problemen wenden Sie sich an Ihren Systemadministrator
                    </span>
                </small>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно "Забыли пароль" (опционально) -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="forgotPasswordModalLabel">
                    <i class="bi bi-question-circle me-2"></i>
                    Passwort vergessen
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Passwort-Wiederherstellung</strong>
                </div>

                <p>Als Administrator-System können Sie Ihr Passwort auf folgende Weise wiederherstellen:</p>

                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="bi bi-1-circle text-primary me-2"></i>
                        <strong>Systemadministrator kontaktieren:</strong><br>
                        <small class="text-muted ms-4">Wenden Sie sich an einen anderen Administrator oder den Systemverantwortlichen</small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-2-circle text-primary me-2"></i>
                        <strong>Datenbank-Zugriff:</strong><br>
                        <small class="text-muted ms-4">Direkte Passwort-Zurücksetzung über MongoDB-Admin-Tools</small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-3-circle text-primary me-2"></i>
                        <strong>Notfall-Zugang:</strong><br>
                        <small class="text-muted ms-4">Konsultieren Sie die Systemdokumentation für Notfall-Verfahren</small>
                    </li>
                </ul>

                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <small>
                        <strong>Sicherheitshinweis:</strong>
                        Aus Sicherheitsgründen ist eine automatische Passwort-Wiederherstellung nicht aktiviert.
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>
                    Schließen
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно системной помощи (опционально) -->
<div class="modal fade" id="systemHelpModal" tabindex="-1" aria-labelledby="systemHelpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="systemHelpModalLabel">
                    <i class="bi bi-question-circle me-2"></i>
                    Systemhilfe
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="bi bi-person-check me-2"></i>Anmeldung</h6>
                        <ul class="list-unstyled small">
                            <li>• Verwenden Sie Ihren Administrator-Benutzernamen</li>
                            <li>• Geben Sie das korrekte Passwort ein</li>
                            <li>• Beachten Sie Groß-/Kleinschreibung</li>
                            <li>• Nach 5 Fehlversuchen: 15 Min Sperre</li>
                        </ul>

                        <h6><i class="bi bi-shield-check me-2"></i>Sicherheit</h6>
                        <ul class="list-unstyled small">
                            <li>• Verwenden Sie nur sichere Netzwerke</li>
                            <li>• Melden Sie sich nach der Arbeit ab</li>
                            <li>• Teilen Sie Zugangsdaten niemals</li>
                            <li>• Verwenden Sie starke Passwörter</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="bi bi-gear me-2"></i>Systemstatus</h6>
                        <ul class="list-unstyled small">
                            <li>• MongoDB: <span class="text-success">Verbunden</span></li>
                            <li>• Benutzer: <span class="text-success">Aktiv</span></li>
                            <li>• Verbindung: <span class="text-success">Sicher (SSL)</span></li>
                            <li>• Version: <span class="text-info">WWS1 v{{ system_version|default:"1.0" }}</span></li>
                        </ul>

                        <h6><i class="bi bi-telephone me-2"></i>Support</h6>
                        <ul class="list-unstyled small">
                            <li>• E-Mail: admin@efsoft.local</li>
                            <li>• Dokumentation: /docs</li>
                            <li>• Logs: Systemadministrator</li>
                            <li>• Notfall: siehe Handbuch</li>
                        </ul>
                    </div>
                </div>

                <div class="alert alert-primary mt-3">
                    <i class="bi bi-lightbulb me-2"></i>
                    <strong>Tipp:</strong> Verwenden Sie Strg+Enter für eine schnelle Anmeldung.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>
                    Schließen
                </button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript для дополнительных модальных окон -->
<script>
function showForgotPasswordModal() {
    const modal = new bootstrap.Modal(document.getElementById('forgotPasswordModal'));
    modal.show();
}

function showSystemHelp() {
    const modal = new bootstrap.Modal(document.getElementById('systemHelpModal'));
    modal.show();
}
</script>