{% load static %}

<nav class="modern-navbar navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid px-4 h-100 d-flex align-items-center">
        <!-- –õ–æ–≥–æ—Ç–∏–ø –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
        <a class="modern-brand navbar-brand d-flex align-items-center" href="{% url 'home' %}">
            <span class="brand-text">{{ company_name|default:"?" }} {{ company_legal_form }}</span>
        </a>

        <!-- –ö–Ω–æ–ø–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
        <button class="modern-toggler navbar-toggler" type="button"
                data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
        <div class="collapse navbar-collapse" id="navbarContent">
            <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
            <ul class="navbar-nav ms-auto d-flex align-items-center">
                <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                {% if is_authenticated and current_user %}
                    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                    <li class="nav-item">
                        <a class="modern-icon-link nav-link position-relative" href="#" title="Benachrichtigungen">
                            <i class="bi bi-bell fs-5"></i>
                            <span class="notification-badge">3</span>
                        </a>
                    </li>

                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    <li class="nav-item">
                        <a class="modern-icon-link nav-link position-relative" href="#" title="Nachrichten">
                            <i class="bi bi-chat-dots fs-5"></i>
                            <span class="notification-badge">1</span>
                        </a>
                    </li>

                    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ò–°–ü–†–ê–í–õ–ï–ù–û -->
                    <li class="nav-item dropdown">
                        <a class="modern-user-link nav-link dropdown-toggle d-flex align-items-center"
                           href="#"
                           id="userDropdown"
                           role="button"
                           data-bs-toggle="dropdown"
                           data-bs-auto-close="true"
                           aria-expanded="false">
                            <img src="{% static 'defaults/img/default-avatar.png' %}"
                                 alt="Avatar" class="user-avatar me-2">
                            <div class="user-info d-none d-lg-block">
                                <div class="user-name">
                                    {% if user_display_name %}
                                        {{ user_display_name }}
                                    {% elif current_user.profile.first_name %}
                                        {{ current_user.profile.first_name }} {{ current_user.profile.last_name|default:"" }}
                                    {% else %}
                                        {{ current_user.username }}
                                    {% endif %}
                                </div>
                                <small class="user-role">
                                    {% if current_user.is_admin %}
                                        Administrator
                                    {% else %}
                                        Benutzer
                                    {% endif %}
                                </small>
                            </div>
                        </a>

                        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±—Ä–∞–ª –≤–ª–æ–∂–µ–Ω–Ω—ã–π ul –∏ —É–ø—Ä–æ—Å—Ç–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É -->
                        <div class="dropdown-menu dropdown-menu-end modern-dropdown" aria-labelledby="userDropdown">
                            <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                            <a class="dropdown-item" href="#" onclick="showUserProfile()">
                                <i class="bi bi-person me-2"></i>
                                Mein Profil
                            </a>

                            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                            <a class="dropdown-item" href="#" onclick="showUserSettings()">
                                <i class="bi bi-gear me-2"></i>
                                Einstellungen
                            </a>

                            <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
                            <hr class="dropdown-divider">

                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                            <div class="dropdown-item-text">
                                <small class="text-muted">
                                    <i class="bi bi-person-badge me-1"></i>
                                    {{ current_user.username }}
                                    {% if current_user.is_admin %}
                                        <span class="badge bg-primary ms-1">Admin</span>
                                    {% endif %}
                                </small>
                            </div>

                            <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
                            <hr class="dropdown-divider">

                            <!-- Logout -->
                            <a class="dropdown-item text-danger" href="#" onclick="confirmLogout(event)">
                                <i class="bi bi-box-arrow-right me-2"></i>
                                Abmelden
                            </a>
                        </div>
                    </li>
                {% else %}
                    <!-- –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <li class="nav-item">
                        <button type="button" class="btn btn-outline-light" onclick="showLoginModal()">
                            <i class="bi bi-box-arrow-in-right me-1"></i>
                            Anmelden
                        </button>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ -->
{% if is_authenticated %}
<div class="modal fade" id="logoutConfirmModal" tabindex="-1" aria-labelledby="logoutConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="logoutConfirmModalLabel">
                    <i class="bi bi-question-circle me-2"></i>
                    Abmeldung best√§tigen
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <i class="bi bi-box-arrow-right display-4 text-warning mb-3"></i>
                <p class="mb-2"><strong>M√∂chten Sie sich wirklich abmelden?</strong></p>
                <p class="text-muted small mb-0">Sie m√ºssen sich erneut anmelden, um das System zu verwenden.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>
                    Abbrechen
                </button>
                <button type="button" class="btn btn-danger" onclick="performLogout()">
                    <i class="bi bi-box-arrow-right me-1"></i>
                    Abmelden
                </button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- JavaScript –¥–ª—è dropdown –∏ logout —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ -->
<script>
// –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bootstrap dropdown
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è navbar dropdowns');

    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ dropdown —ç–ª–µ–º–µ–Ω—Ç—ã
    const dropdownTriggerList = document.querySelectorAll('[data-bs-toggle="dropdown"]');
    const dropdownList = [...dropdownTriggerList].map(dropdownTriggerEl => {
        const dropdown = new bootstrap.Dropdown(dropdownTriggerEl, {
            autoClose: true,
            boundary: 'viewport'
        });

        console.log('‚úÖ Dropdown –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', dropdownTriggerEl.id);
        return dropdown;
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    const userDropdown = document.getElementById('userDropdown');
    if (userDropdown) {
        userDropdown.addEventListener('click', function(e) {
            console.log('üñ±Ô∏è Click –Ω–∞ user dropdown');
        });

        userDropdown.addEventListener('show.bs.dropdown', function(e) {
            console.log('üëÅÔ∏è User dropdown –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è');
        });

        userDropdown.addEventListener('shown.bs.dropdown', function(e) {
            console.log('‚úÖ User dropdown –ø–æ–∫–∞–∑–∞–Ω');
        });

        userDropdown.addEventListener('hide.bs.dropdown', function(e) {
            console.log('üëÅÔ∏è User dropdown —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è');
        });
    }
});

function confirmLogout(event) {
    event.preventDefault();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    const modal = new bootstrap.Modal(document.getElementById('logoutConfirmModal'));
    modal.show();
}

function performLogout() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const logoutBtn = document.querySelector('#logoutConfirmModal .btn-danger');
    if (logoutBtn) {
        logoutBtn.disabled = true;
        logoutBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>Abmeldung...';
    }

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = bootstrap.Modal.getInstance(document.getElementById('logoutConfirmModal'));
    if (modal) {
        modal.hide();
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    if (typeof window.showToast === 'function') {
        window.showToast('Sie werden abgemeldet...', 'info', 2000);
    }

    // –í—ã–ø–æ–ª–Ω—è–µ–º logout —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    setTimeout(() => {
        window.location.href = '{% url "users:logout" %}';
    }, 1000);
}

function showUserProfile() {
    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (typeof window.showToast === 'function') {
        window.showToast('Benutzerprofilfunktion wird entwickelt', 'info');
    } else {
        alert('Benutzerprofilfunktion wird entwickelt');
    }
}

function showUserSettings() {
    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (typeof window.showToast === 'function') {
        window.showToast('Einstellungsfunktion wird entwickelt', 'info');
    } else {
        alert('Einstellungsfunktion wird entwickelt');
    }
}

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—Ö–æ–¥–∞
function showLoginModal() {
    if (window.loginModal) {
        window.loginModal.showModal();
    } else if (typeof window.showToast === 'function') {
        window.showToast('Anmeldesystem wird geladen...', 'info');
    }
}

// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ dropdown –≤ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
{#document.addEventListener('DOMContentLoaded', function() {#}
{#    console.log('üîß –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è dropdown –≤ viewport...');#}
{##}
{#    const userDropdownToggle = document.getElementById('userDropdown');#}
{#    const userDropdownMenu = document.querySelector('#userDropdown + .dropdown-menu');#}
{##}
{#    if (!userDropdownToggle || !userDropdownMenu) {#}
{#        console.error('‚ùå Dropdown —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');#}
{#        return;#}
{#    }#}
{##}
{#    function smartDropdownPosition() {#}
{#        // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã viewport#}
{#        const viewportWidth = window.innerWidth;#}
{#        const viewportHeight = window.innerHeight;#}
{##}
{#        // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é toggle –∫–Ω–æ–ø–∫–∏#}
{#        const toggleRect = userDropdownToggle.getBoundingClientRect();#}
{##}
{#        // –†–∞–∑–º–µ—Ä—ã dropdown –º–µ–Ω—é#}
{#        const menuWidth = 250; // –Ω–∞—à–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞#}
{#        const estimatedMenuHeight = 200; // –ø—Ä–∏–º–µ—Ä–Ω–∞—è –≤—ã—Å–æ—Ç–∞#}
{##}
{#        console.log('üìä Viewport:', { width: viewportWidth, height: viewportHeight });#}
{#        console.log('üìç Toggle position:', toggleRect);#}
{##}
{#        // –í—ã—á–∏—Å–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é#}
{#        let left = 'auto';#}
{#        let right = '0';#}
{#        let top = 'calc(100% + 0.5rem)';#}
{##}
{#        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–º–µ—â–∞–µ—Ç—Å—è –ª–∏ dropdown —Å–ø—Ä–∞–≤–∞ –æ—Ç toggle#}
{#        const spaceOnRight = viewportWidth - toggleRect.right;#}
{#        const spaceOnLeft = toggleRect.left;#}
{##}
{#        console.log('üìè –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–ø—Ä–∞–≤–∞:', spaceOnRight, '—Å–ª–µ–≤–∞:', spaceOnLeft);#}
{##}
{#        if (spaceOnRight < menuWidth && spaceOnLeft >= menuWidth) {#}
{#            // –ï—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–µ—Å—Ç–∞, –Ω–æ —Å–ª–µ–≤–∞ –µ—Å—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–≤–∞#}
{#            console.log('üìç –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º dropdown —Å–ª–µ–≤–∞ –æ—Ç –∫–Ω–æ–ø–∫–∏');#}
{#            right = 'auto';#}
{#            left = '0';#}
{#        } else if (spaceOnRight < menuWidth && spaceOnLeft < menuWidth) {#}
{#            // –ï—Å–ª–∏ –º–µ—Å—Ç–∞ –Ω–µ—Ç –Ω–∏ —Å–ø—Ä–∞–≤–∞, –Ω–∏ —Å–ª–µ–≤–∞ - —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ viewport#}
{#            console.log('üìç –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º dropdown –≤ viewport');#}
{#            const centerPosition = Math.max(20, (viewportWidth - menuWidth) / 2);#}
{#            right = 'auto';#}
{#            left = `${centerPosition}px`;#}
{##}
{#            // –ú–µ–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ fixed#}
{#            userDropdownMenu.style.position = 'fixed !important';#}
{#            top = `${toggleRect.bottom + 8}px`;#}
{#        }#}
{##}
{#        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ#}
{#        const spaceBelow = viewportHeight - toggleRect.bottom;#}
{#        if (spaceBelow < estimatedMenuHeight) {#}
{#            // –ï—Å–ª–∏ –≤–Ω–∏–∑—É –º–∞–ª–æ –º–µ—Å—Ç–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–µ—Ä—Ö—É#}
{#            console.log('üìç –ü–æ–∫–∞–∑—ã–≤–∞–µ–º dropdown —Å–≤–µ—Ä—Ö—É');#}
{#            top = 'auto';#}
{#            userDropdownMenu.style.bottom = 'calc(100% + 0.5rem)';#}
{#        }#}
{##}
{#        // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏#}
{#        const newStyles = `#}
{#            position: ${userDropdownMenu.style.position || 'absolute'} !important;#}
{#            z-index: 1055 !important;#}
{#            ${top !== 'auto' ? `top: ${top} !important;` : ''}#}
{#            ${right !== 'auto' ? `right: ${right} !important;` : ''}#}
{#            ${left !== 'auto' ? `left: ${left} !important;` : ''}#}
{#            transform: none !important;#}
{#            margin: 0 !important;#}
{#            min-width: ${menuWidth}px !important;#}
{#            max-width: ${Math.min(menuWidth + 100, viewportWidth - 40)}px !important;#}
{#            background: white !important;#}
{#            border: 1px solid #dee2e6 !important;#}
{#            border-radius: 0.375rem !important;#}
{#            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;#}
{#            padding: 0.5rem !important;#}
{#            display: ${userDropdownMenu.classList.contains('show') ? 'block' : 'none'} !important;#}
{#        `;#}
{##}
{#        userDropdownMenu.style.cssText = newStyles;#}
{##}
{#        console.log('‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —É–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è');#}
{#        console.log('üìã –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏:', newStyles);#}
{##}
{#        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏#}
{#        setTimeout(() => {#}
{#            const menuRect = userDropdownMenu.getBoundingClientRect();#}
{#            console.log('üìç –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è dropdown:', menuRect);#}
{##}
{#            const isVisible = menuRect.top >= 0 &&#}
{#                            menuRect.left >= 0 &&#}
{#                            menuRect.bottom <= viewportHeight &&#}
{#                            menuRect.right <= viewportWidth;#}
{##}
{#            console.log('üëÅÔ∏è Dropdown –≤–∏–¥–∏–º –≤ viewport:', isVisible);#}
{##}
{#            if (!isVisible) {#}
{#                console.log('üö® Dropdown –≤—Å–µ –µ—â–µ –Ω–µ –≤–∏–¥–µ–Ω, –ø—Ä–∏–º–µ–Ω—è–µ–º —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é');#}
{#                userDropdownMenu.style.cssText = `#}
{#                    position: fixed !important;#}
{#                    z-index: 1055 !important;#}
{#                    top: 70px !important;#}
{#                    right: 20px !important;#}
{#                    left: auto !important;#}
{#                    transform: none !important;#}
{#                    margin: 0 !important;#}
{#                    min-width: 250px !important;#}
{#                    max-width: 350px !important;#}
{#                    background: white !important;#}
{#                    border: 1px solid #dee2e6 !important;#}
{#                    border-radius: 0.375rem !important;#}
{#                    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;#}
{#                    padding: 0.5rem !important;#}
{#                    display: block !important;#}
{#                `;#}
{#                console.log('üõ°Ô∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è');#}
{#            }#}
{#        }, 50);#}
{#    }#}
{##}
{#    // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∏ –ø–æ–∫–∞–∑–µ dropdown#}
{#    userDropdownToggle.addEventListener('show.bs.dropdown', function(e) {#}
{#        console.log('üîß –ü–æ–∫–∞–∑—ã–≤–∞–µ–º dropdown —Å —É–º–Ω—ã–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º...');#}
{#        setTimeout(smartDropdownPosition, 0);#}
{#    });#}
{##}
{#    userDropdownToggle.addEventListener('shown.bs.dropdown', function(e) {#}
{#        console.log('üîß Dropdown –ø–æ–∫–∞–∑–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∑–∏—Ü–∏—é...');#}
{#        smartDropdownPosition();#}
{##}
{#        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 100ms#}
{#        setTimeout(smartDropdownPosition, 100);#}
{#    });#}
{##}
{#    // –ü–µ—Ä–µ–µ–∑–¥ dropdown –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞#}
{#    window.addEventListener('resize', () => {#}
{#        if (userDropdownMenu.classList.contains('show')) {#}
{#            console.log('üì± –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω, –ø–µ—Ä–µ–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º dropdown');#}
{#            smartDropdownPosition();#}
{#        }#}
{#    });#}
{##}
{#    // –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 500ms#}
{#    setInterval(() => {#}
{#        if (userDropdownMenu.classList.contains('show')) {#}
{#            const menuRect = userDropdownMenu.getBoundingClientRect();#}
{#            const isVisible = menuRect.width > 0 && menuRect.height > 0 &&#}
{#                            menuRect.top >= 0 && menuRect.left >= 0 &&#}
{#                            menuRect.bottom <= window.innerHeight &&#}
{#                            menuRect.right <= window.innerWidth;#}
{##}
{#            if (!isVisible) {#}
{#                console.log('üö® Dropdown —Å–∫—Ä—ã–ª—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º');#}
{#                smartDropdownPosition();#}
{#            }#}
{#        }#}
{#    }, 500);#}
{##}
{#    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –Ω–∞ localhost)#}
{#    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {#}
{#        const testBtn = document.createElement('button');#}
{#        testBtn.textContent = 'Force Show Dropdown';#}
{#        testBtn.style.cssText = `#}
{#            position: fixed;#}
{#            top: 70px;#}
{#            left: 10px;#}
{#            z-index: 9999;#}
{#            background: #28a745;#}
{#            color: white;#}
{#            padding: 8px 12px;#}
{#            border: none;#}
{#            border-radius: 4px;#}
{#            font-size: 12px;#}
{#            cursor: pointer;#}
{#        `;#}
{#        testBtn.onclick = function() {#}
{#            console.log('üß™ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–∫–∞–∑—ã–≤–∞–Ω–∏–µ dropdown...');#}
{#            userDropdownMenu.classList.add('show');#}
{#            userDropdownToggle.setAttribute('aria-expanded', 'true');#}
{#            smartDropdownPosition();#}
{#        };#}
{#        document.body.appendChild(testBtn);#}
{#    }#}
{##}
{#    console.log('‚úÖ –£–º–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ dropdown –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ');#}
{#});#}
</script>