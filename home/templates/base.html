{% load static %}

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ company_name|default:"WWS1" }}{% endblock %}</title>

    <link rel="icon" href="{% static 'defaults/img/favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'defaults/img/apple-touch-icon.png' %}">
    <link rel="apple-touch-icon-precomposed" href="{% static 'defaults/img/apple-touch-icon-precomposed.png' %}">

    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/icons/bootstrap-icons.css' %}">

    <link rel="stylesheet" href="{% static 'select2/dist/css/select2.min.css' %}">
    <link rel="stylesheet" href="{% static 'select2-bootstrap-5-theme/select2-bootstrap-5-theme.min.css' %}">

    <link rel="stylesheet" href="{% static 'css/layout-heights.css' %}">
    <link rel="stylesheet" href="{% static 'css/main_styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" href="{% static 'css/toasts.css' %}">

    <!-- DEBUG: is_authenticated={{ is_authenticated }}, is_admin_creation_page={{ is_admin_creation_page }} -->

    <!-- –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    {% if not is_authenticated and not is_admin_creation_page %}
    <link rel="stylesheet" href="{% static 'css/login_modal.css' %}">
    <!-- DEBUG: LOGIN CSS LOADED -->
    {% endif %}

    {% block extra_css %}{% endblock %}
</head>
<body class="modern-body">

<!-- –í–µ—Ä—Ö–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è - –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º -->
{% block navbar %}
    {% include 'navbar.html' %}
{% endblock %}

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º -->
<div class="main-container d-flex">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å - –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º -->
    {% block navmenu %}
        {% include 'sidebar.html' %}
    {% endblock %}

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content flex-grow-1">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <main class="content-wrapper">
            {% block content %}{% endblock %}
        </main>

        <!-- –ü–æ–¥–≤–∞–ª -->
        <footer class="main-footer">
            <div class="footer-content">
                <p class="text-muted text-center">
                    &copy; 2025 EF-SOFT
                </p>
            </div>
        </footer>
    </div>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–æ—Å—Ç–æ–≤ -->
<div id="toast-container"></div>

<!-- DEBUG: Checking login modal conditions -->
<!-- is_authenticated: {{ is_authenticated }} -->
<!-- is_admin_creation_page: {{ is_admin_creation_page }} -->

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ -->
{% if not is_authenticated and not is_admin_creation_page %}
    <!-- DEBUG: LOGIN MODAL INCLUDED -->
    {% include 'login_modal.html' %}
{% else %}
    <!-- DEBUG: LOGIN MODAL NOT INCLUDED - is_authenticated={{ is_authenticated }}, is_admin_creation_page={{ is_admin_creation_page }} -->
{% endif %}

<!-- –°–∫—Ä—ã—Ç—ã–µ Django —Å–æ–æ–±—â–µ–Ω–∏—è -->
<div id="django-messages" style="display: none;">
    {% for message in messages %}
        <div data-tags="{{ message.tags }}" data-text="{{ message|force_escape }}" data-delay="5000"></div>
    {% endfor %}
</div>

<!-- JavaScript -->
<script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'jquery/jquery-3.7.1.min.js' %}"></script>
<script src="{% static 'select2/dist/js/select2.min.js' %}"></script>
<script src="{% static 'select2/dist/js/i18n/de.js' %}"></script>
<script src="{% static 'htmx/js/htmx.min.js' %}"></script>

<!-- Toast —Å–∏—Å—Ç–µ–º–∞ -->
<script src="{% static 'js/toasts.js' %}"></script>

<!-- Sidebar —Å–∫—Ä–∏–ø—Ç - –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º -->
<script src="{% static 'js/sidebar.js' %}"></script>

<!-- Login modal - –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ -->
{% if not is_authenticated and not is_admin_creation_page %}
<script src="{% static 'js/login_modal.js' %}"></script>
<script>
    console.log('üîê Login modal JS –∑–∞–≥—Ä—É–∂–µ–Ω');
</script>
{% else %}
<script>
    console.log('üö´ Login modal JS –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω - is_authenticated={{ is_authenticated }}, is_admin_creation_page={{ is_admin_creation_page }}');
</script>
{% endif %}

<!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ -->
<script>
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    window.currentUser = {% if current_user %}{{ current_user|safe }}{% else %}null{% endif %};
    window.isAuthenticated = {{ is_authenticated|yesno:"true,false" }};
    window.systemInfo = {{ system_info|safe|default:"null" }};
    window.isAdminCreationPage = {{ is_admin_creation_page|yesno:"true,false" }};

    console.log('üîç DEBUG INFO:');
    console.log('  - isAuthenticated:', window.isAuthenticated);
    console.log('  - isAdminCreationPage:', window.isAdminCreationPage);
    console.log('  - Current URL:', window.location.pathname);

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—Ö–æ–¥–∞
    function showLoginModal() {
        console.log('üìû showLoginModal() –≤—ã–∑–≤–∞–Ω–∞');

        // –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        if (window.isAdminCreationPage) {
            console.log('üö´ Login modal –æ—Ç–∫–ª—é—á–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
            return;
        }

        if (window.isAuthenticated) {
            console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
            if (typeof window.showToast === 'function') {
                window.showToast('Sie sind bereits angemeldet', 'info');
            }
            return;
        }

        if (window.loginModal) {
            console.log('‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º login modal');
            window.loginModal.showModal();
        } else {
            console.error('‚ùå Login modal –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            if (typeof window.showToast === 'function') {
                window.showToast('Anmeldesystem wird geladen...', 'info');
            }
        }
    }
</script>

{% block extra_js %}{% endblock %}
</body>
</html>