{% load static %}

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ company_name|default:"WWS1" }}{% endblock %}</title>

    <link rel="icon" href="{% static 'defaults/img/favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'defaults/img/apple-touch-icon.png' %}">
    <link rel="apple-touch-icon-precomposed" href="{% static 'defaults/img/apple-touch-icon-precomposed.png' %}">

    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/icons/bootstrap-icons.css' %}">

    <link rel="stylesheet" href="{% static 'select2/dist/css/select2.min.css' %}">
    <link rel="stylesheet" href="{% static 'select2-bootstrap-5-theme/select2-bootstrap-5-theme.min.css' %}">

    <link rel="stylesheet" href="{% static 'css/layout-heights.css' %}">
    <link rel="stylesheet" href="{% static 'css/main_styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" href="{% static 'css/toasts.css' %}">

    <!-- Стили для модального окна аутентификации -->
    {% if not is_authenticated %}
    <link rel="stylesheet" href="{% static 'css/login_modal.css' %}">
    {% endif %}

    {% block extra_css %}{% endblock %}
</head>
<body class="modern-body">

<!-- Верхняя навигация - ВСЕГДА показываем -->
{% block navbar %}
    {% include 'navbar.html' %}
{% endblock %}

<!-- Основной контейнер с боковой панелью и контентом -->
<div class="main-container d-flex">
    <!-- Боковая панель - ВСЕГДА показываем -->
    {% block navmenu %}
        {% include 'sidebar.html' %}
    {% endblock %}

    <!-- Основной контент -->
    <div class="main-content flex-grow-1">
        <!-- Основной контент страницы -->
        <main class="content-wrapper">
            {% block content %}{% endblock %}
        </main>

        <!-- Подвал -->
        <footer class="main-footer">
            <div class="footer-content">
                <p class="text-muted text-center">
                    &copy; 2025 EF-SOFT

{#                    &copy; 2025 {{ company_name|default:"WWS1" }} EF-SOFT#}
{#                    {% if system_version %}#}
{#                        • Version {{ system_version }}#}
{#                    {% endif %}#}
{#                    {% if is_authenticated and user_display_name %}#}
{#                        • Angemeldet als: {{ user_display_name }}#}
{#                    {% endif %}#}
                </p>
            </div>
        </footer>
    </div>
</div>

<!-- Контейнер тостов -->
<div id="toast-container"></div>

<!-- Модальное окно аутентификации (для неавторизованных пользователей) -->
{% if not is_authenticated %}
    {% include 'login_modal.html' %}
{% endif %}

<!-- Скрытые Django сообщения -->
<div id="django-messages" style="display: none;">
    {% for message in messages %}
        <div data-tags="{{ message.tags }}" data-text="{{ message|force_escape }}" data-delay="5000"></div>
    {% endfor %}
</div>

<!-- JavaScript -->
<script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'jquery/jquery-3.7.1.min.js' %}"></script>
<script src="{% static 'select2/dist/js/select2.min.js' %}"></script>
<script src="{% static 'select2/dist/js/i18n/de.js' %}"></script>
<script src="{% static 'htmx/js/htmx.min.js' %}"></script>

<!-- Toast система -->
<script src="{% static 'js/toasts.js' %}"></script>

<!-- Sidebar скрипт - всегда загружаем -->
<script src="{% static 'js/sidebar.js' %}"></script>

<!-- Login modal - только для неавторизованных -->
{% if not is_authenticated %}
<script src="{% static 'js/login_modal.js' %}"></script>
{% endif %}

<!-- Глобальные переменные -->
<script>
    // Информация о текущем пользователе
    window.currentUser = {% if current_user %}{{ current_user|safe }}{% else %}null{% endif %};
    window.isAuthenticated = {{ is_authenticated|yesno:"true,false" }};
    window.systemInfo = {{ system_info|safe|default:"null" }};

    // Глобальная функция для показа модального окна входа
    function showLoginModal() {
        if (window.isAuthenticated) {
            if (typeof window.showToast === 'function') {
                window.showToast('Sie sind bereits angemeldet', 'info');
            }
            return;
        }

        if (window.loginModal) {
            window.loginModal.showModal();
        } else {
            console.error('Login modal не инициализирован');
            if (typeof window.showToast === 'function') {
                window.showToast('Anmeldesystem wird geladen...', 'info');
            }
        }
    }
</script>

{% block extra_js %}{% endblock %}
</body>
</html>