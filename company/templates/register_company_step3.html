{% extends 'base.html' %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/create_admin_step1-3.css' %}">
{% load company_extras %}

{% block content %}
<div class="modal fade show" id="companyModal" tabindex="-1" aria-modal="true" role="dialog" style="display: block;">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="bi bi-geo-alt me-2"></i>{{ text.title }}
                </h5>
                <span class="badge bg-light text-dark ms-auto">Schritt {{ step }} von 5</span>
                <button type="button" class="btn-close btn-close-white ms-3" onclick="closeModal()"></button>
            </div>

            <div class="modal-body">
                <div class="alert alert-info" role="alert">
                    <i class="bi bi-info-circle me-2"></i>{{ text.desc }}
                    <br><small class="text-muted mt-1">
                        <i class="bi bi-lightbulb me-1"></i>
                        <strong>Tipp:</strong> Sie k√∂nnen entweder PLZ oder Stadt eingeben - das andere Feld wird automatisch aktualisiert
                    </small>
                </div>

                <form method="post" id="company-step3-form"
                      data-url="{% url 'company:register_company_step3' %}"
                      data-next-url="{% url 'company:register_company_step4' %}"
                      data-city-by-plz-url="{% url 'company:get_city_by_plz' %}"
                      data-plz-by-city-url="{% url 'company:get_plz_by_city' %}"
                      data-cities-autocomplete-url="{% url 'company:search_cities_autocomplete' %}"
                      data-plz-ajax-url="{% url 'company:search_plz_ajax' %}">
                    {% csrf_token %}

                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="bi bi-building me-2"></i>Gesch√§ftsadresse
                            </h6>
                        </div>
                        <div class="card-body">
                            <!-- Street -->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="{{ form.street.id_for_label }}" class="form-label">
                                            <i class="bi bi-signpost me-1"></i>Stra√üe und Hausnummer
                                            <span class="text-danger">*</span>
                                        </label>
                                        {{ form.street }}
                                        <div class="form-text">z.B. Hauptstra√üe 123</div>
                                    </div>
                                </div>
                            </div>

                            <!-- PLZ + City with bidirectional sync -->
                            <div class="row">
                                <!-- PLZ Select2 -->
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="id_postal_code" class="form-label">
                                            <i class="bi bi-mailbox me-1"></i>Postleitzahl (PLZ)
                                            <span class="text-danger">*</span>
                                        </label>
                                        <select name="{{ form.postal_code.name }}"
                                                id="id_postal_code"
                                                class="form-select"
                                                required>
                                            <option></option>
                                            {% if form.postal_code.value %}
                                                <option value="{{ form.postal_code.value }}" selected>
                                                    {{ form.postal_code.value }}
                                                </option>
                                            {% endif %}
                                        </select>
                                        <div class="form-text">
                                            <i class="bi bi-search me-1"></i>
                                            PLZ suchen
                                        </div>
                                    </div>
                                </div>

                                <!-- City Select2 with AJAX -->
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label for="id_city" class="form-label">
                                            <i class="bi bi-buildings me-1"></i>Stadt
                                            <span class="text-danger">*</span>
                                        </label>
                                        <select name="city"
                                                id="id_city"
                                                class="form-select"
                                                required>
                                            <option></option>
                                            {% if form.city.value %}
                                                <option value="{{ form.city.value }}" selected>
                                                    {{ form.city.value }}
                                                </option>
                                            {% endif %}
                                        </select>
                                        <div class="form-text">
                                            <i class="bi bi-search me-1"></i>
                                            Stadt eingeben (mind. 2 Zeichen) - PLZ wird gefiltert
                                        </div>
                                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ PLZ –ø–æ –≥–æ—Ä–æ–¥—É -->
                                        <div id="plz-results" class="mt-2" style="display: none;">
                                            <small class="text-success">
                                                <i class="bi bi-check-circle me-1"></i>
                                                <span id="plz-count"></span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Country -->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="id_country" class="form-label">
                                            <i class="bi bi-globe-europe-africa me-1"></i>Land
                                            <span class="text-danger">*</span>
                                        </label>
                                        <select name="{{ form.country.name }}"
                                                id="id_country"
                                                class="form-select"
                                                required>
                                            <option></option>
                                            {% for value, text in form.country.field.choices %}
                                                {% if value %}
                                                    <option value="{{ value }}"
                                                            {% if form.country.value == value or text == "Deutschland" %}selected{% endif %}>
                                                        {{ text }}
                                                    </option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <a href="{% url 'company:register_company_step2' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-1"></i>Zur√ºck
                        </a>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-success" id="save-and-close-btn">
                                <i class="bi bi-check-circle me-1"></i>Sichern & Schlie√üen
                            </button>
                            <button type="submit" class="btn btn-success" id="continue-btn">
                                <i class="bi bi-arrow-right me-1"></i>Weiter
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade show"></div>
{% endblock %}

{% block extra_js %}
<script>
// ==================== –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ====================

$(document).ready(function() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏ PLZ ‚Üî Stadt');
    $.fn.select2.defaults.set('language', 'de');

    const form = $('#company-step3-form');
    const cityByPlzUrl = form.data('city-by-plz-url');
    const plzByCityUrl = form.data('plz-by-city-url');
    const citiesAutocompleteUrl = form.data('cities-autocomplete-url');
    const plzAjaxUrl = form.data('plz-ajax-url');

    // ==================== PLZ Select2 —Å AJAX –ø–æ–∏—Å–∫–æ–º ====================
    const plzSelect = $('#id_postal_code').select2({
        theme: 'bootstrap-5',
        placeholder: 'PLZ eingeben (mind. 2 Zeichen)...',
        allowClear: true,
        width: '100%',
        dropdownParent: $('#companyModal'),
        minimumInputLength: 2,  // –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ —Å 2 —Å–∏–º–≤–æ–ª–æ–≤
        language: {
            noResults: () => 'Keine PLZ gefunden',
            searching: () => 'Suche l√§uft...',
            inputTooShort: () => 'Bitte mindestens 2 Zeichen eingeben',
            removeAllItems: () => 'Auswahl entfernen',
            loadingMore: () => 'Weitere Ergebnisse laden...'
        },
        ajax: {
            url: plzAjaxUrl,
            dataType: 'json',
            delay: 300,  // Debounce
            data: function(params) {
                return {
                    q: params.term,  // –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                    page: params.page || 1
                };
            },
            processResults: function(data, params) {
                params.page = params.page || 1;

                return {
                    results: data.results,
                    pagination: {
                        more: data.pagination.more
                    }
                };
            },
            cache: true
        }
    });

    // –ü—Ä–∏ –≤—ã–±–æ—Ä–µ PLZ ‚Üí –ø–æ–ª—É—á–∞–µ–º –≥–æ—Ä–æ–¥
    plzSelect.on('select2:select', function(e) {
        handlePlzSelect(e);
    });

    // –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ PLZ ‚Üí –æ—á–∏—â–∞–µ–º –≥–æ—Ä–æ–¥
    plzSelect.on('select2:clear', function() {
        handlePlzClear();
    });

    // ==================== Stadt Select2 —Å AJAX –ø–æ–∏—Å–∫–æ–º ====================
    const citySelect = $('#id_city').select2({
        theme: 'bootstrap-5',
        placeholder: 'Stadt eingeben (mind. 2 Zeichen)...',
        allowClear: true,
        width: '100%',
        dropdownParent: $('#companyModal'),
        minimumInputLength: 2,
        language: {
            noResults: () => 'Keine Stadt gefunden',
            searching: () => 'Suche l√§uft...',
            inputTooShort: () => 'Bitte mindestens 2 Zeichen eingeben',
            removeAllItems: () => 'Auswahl entfernen'
        },
        ajax: {
            url: citiesAutocompleteUrl,
            dataType: 'json',
            delay: 300,
            data: function(params) {
                return {
                    q: params.term
                };
            },
            processResults: function(data) {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ –≥–æ—Ä–æ–¥–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç Select2
                return {
                    results: data.cities.map(city => ({
                        id: city,
                        text: city
                    }))
                };
            },
            cache: true
        },
        // –†–∞–∑—Ä–µ—à–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–ø—Ü–∏–π (–µ—Å–ª–∏ –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω)
        tags: false
    });

    // –ü—Ä–∏ –≤—ã–±–æ—Ä–µ Stadt ‚Üí —Ñ–∏–ª—å—Ç—Ä—É–µ–º PLZ
    citySelect.on('select2:select', function(e) {
        handleCitySelect(e);
    });

    // –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ Stadt ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ PLZ
    citySelect.on('select2:clear', function() {
        handleCityClear();
    });

    // ==================== Country Select2 ====================
    $('#id_country').select2({
        theme: 'bootstrap-5',
        placeholder: 'Land ausw√§hlen...',
        allowClear: true,
        width: '100%',
        dropdownParent: $('#companyModal'),
        language: {
            noResults: () => 'Keine Ergebnisse gefunden',
            searching: () => 'Suche l√§uft...'
        }
    }).on('select2:select', function(e) {
        $(this).removeClass('is-invalid').addClass('is-valid');
    });

    console.log('‚úÖ Select2 –∏ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
});

// ==================== –§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ PLZ ====================

function filterPlzByCity(results) {
    const plzSelect = $('#id_postal_code');

    console.log('üîß –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è PLZ - –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Ä–µ–∂–∏–º');

    // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º Select2
    plzSelect.select2('destroy');

    // –í–ê–ñ–ù–û: –û—á–∏—â–∞–µ–º –≤—Å–µ - –∏ –æ–ø—Ü–∏–∏, –∏ –∑–Ω–∞—á–µ–Ω–∏–µ
    plzSelect.empty();
    plzSelect.val('');  // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

    // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
    plzSelect.append(new Option('', '', false, false));

    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ PLZ
    results.forEach(item => {
        plzSelect.append(new Option(
            item.plz_name_long,
            item.plz_code,
            false,  // –Ω–µ –≤—ã–±—Ä–∞–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            false
        ));
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Select2 –ë–ï–ó AJAX (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
    plzSelect.select2({
        theme: 'bootstrap-5',
        placeholder: 'PLZ ausw√§hlen...',
        allowClear: true,
        width: '100%',
        dropdownParent: $('#companyModal'),
        language: {
            noResults: () => 'Keine PLZ in dieser Liste',
            searching: () => 'Suche l√§uft...'
        }
    }).on('select2:select', function(e) {
        handlePlzSelect(e);
    }).on('select2:clear', function() {
        handlePlzClear();
    }).val(null).trigger('change');  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è

    console.log(`‚úÖ PLZ gefiltert: ${results.length} Ergebnisse (statischer Modus, alte Werte gel√∂scht)`);
}

function restoreAllPlzOptions() {
    const plzSelect = $('#id_postal_code');
    const citySelect = $('#id_city');
    const form = $('#company-step3-form');
    const plzAjaxUrl = form.data('plz-ajax-url');
    const citiesAutocompleteUrl = form.data('cities-autocomplete-url');

    console.log('üîÑ Wiederherstellung AJAX-Modus f√ºr PLZ und Stadt');

    // === PLZ: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º AJAX —Ä–µ–∂–∏–º ===
    plzSelect.select2('destroy');
    plzSelect.empty();
    plzSelect.val('');  // –û—á–∏—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–Ω–æ
    plzSelect.append(new Option('', '', false, false));

    plzSelect.select2({
        theme: 'bootstrap-5',
        placeholder: 'PLZ eingeben (mind. 2 Zeichen)...',
        allowClear: true,
        width: '100%',
        dropdownParent: $('#companyModal'),
        minimumInputLength: 2,
        language: {
            noResults: () => 'Keine PLZ gefunden',
            searching: () => 'Suche l√§uft...',
            inputTooShort: () => 'Bitte mindestens 2 Zeichen eingeben',
            removeAllItems: () => 'Auswahl entfernen',
            loadingMore: () => 'Weitere Ergebnisse laden...'
        },
        ajax: {
            url: plzAjaxUrl,
            dataType: 'json',
            delay: 300,
            data: function(params) {
                return {
                    q: params.term,
                    page: params.page || 1
                };
            },
            processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                    results: data.results,
                    pagination: {
                        more: data.pagination.more
                    }
                };
            },
            cache: true
        }
    }).on('select2:select', function(e) {
        handlePlzSelect(e);
    }).on('select2:clear', function() {
        handlePlzClear();
    }).val(null).trigger('change');  // –û—á–∏—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

    // === Stadt: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º AJAX —Ä–µ–∂–∏–º ===
    citySelect.select2('destroy');
    citySelect.empty();
    citySelect.val('');  // –û—á–∏—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–Ω–æ
    citySelect.append(new Option('', '', false, false));

    citySelect.select2({
        theme: 'bootstrap-5',
        placeholder: 'Stadt eingeben (mind. 2 Zeichen)...',
        allowClear: true,
        width: '100%',
        dropdownParent: $('#companyModal'),
        minimumInputLength: 2,
        language: {
            noResults: () => 'Keine Stadt gefunden',
            searching: () => 'Suche l√§uft...',
            inputTooShort: () => 'Bitte mindestens 2 Zeichen eingeben',
            removeAllItems: () => 'Auswahl entfernen'
        },
        ajax: {
            url: citiesAutocompleteUrl,
            dataType: 'json',
            delay: 300,
            data: function(params) {
                return {
                    q: params.term
                };
            },
            processResults: function(data) {
                return {
                    results: data.cities.map(city => ({
                        id: city,
                        text: city
                    }))
                };
            },
            cache: true
        }
    }).on('select2:select', function(e) {
        handleCitySelect(e);
    }).on('select2:clear', function() {
        handleCityClear();
    }).val(null).trigger('change');  // –û—á–∏—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

    // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    $('#plz-results').hide();

    console.log('‚úÖ AJAX-Modus f√ºr PLZ und Stadt wiederhergestellt (Werte gel√∂scht)');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π PLZ
function handlePlzSelect(e) {
    const plzCode = e.params.data.id;
    const form = $('#company-step3-form');
    const cityByPlzUrl = form.data('city-by-plz-url');

    console.log('‚úÖ PLZ ausgew√§hlt:', plzCode);

    // –ü–æ–ª—É—á–∞–µ–º –≥–æ—Ä–æ–¥ –ø–æ PLZ
    fetch(`${cityByPlzUrl}?plz=${plzCode}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ Stadt Select2
                const citySelect = $('#id_city');

                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –æ–ø—Ü–∏—é –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
                if (citySelect.find(`option[value="${data.city}"]`).length === 0) {
                    const newOption = new Option(data.city, data.city, true, true);
                    citySelect.append(newOption);
                } else {
                    citySelect.val(data.city);
                }

                citySelect.trigger('change').addClass('is-valid');
                console.log('‚úÖ Stadt automatisch ausgef√ºllt:', data.city);
            }
        })
        .catch(error => console.error('Fehler beim Laden der Stadt:', error));

    $('#id_postal_code').removeClass('is-invalid').addClass('is-valid');
}

function handlePlzClear() {
    console.log('üóëÔ∏è PLZ gel√∂scht - Stadt wird gel√∂scht');

    // –û—á–∏—â–∞–µ–º Stadt
    $('#id_city').val(null).trigger('change').removeClass('is-valid is-invalid');
    $('#id_postal_code').removeClass('is-valid is-invalid');
    $('#plz-results').hide();

    // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º restoreAllPlzOptions –∑–¥–µ—Å—å!
    // –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Stadt
function handleCitySelect(e) {
    const cityName = e.params.data.text;
    const form = $('#company-step3-form');
    const plzByCityUrl = form.data('plz-by-city-url');

    console.log('‚úÖ Stadt ausgew√§hlt:', cityName);

    // –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π PLZ
    $('#id_postal_code').val(null).trigger('change').removeClass('is-valid is-invalid');

    // –ü–æ–ª—É—á–∞–µ–º PLZ –ø–æ –≥–æ—Ä–æ–¥—É
    fetch(`${plzByCityUrl}?city=${encodeURIComponent(cityName)}`)
        .then(response => response.json())
        .then(data => {
            if (data.success && data.results.length > 0) {
                // –§–∏–ª—å—Ç—Ä—É–µ–º PLZ Select2
                filterPlzByCity(data.results);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                $('#plz-results').show();
                $('#plz-count').text(`${data.count} PLZ gefunden f√ºr "${cityName}"`);

                // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω PLZ - –≤—ã–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                if (data.results.length === 1) {
                    const plzCode = data.results[0].plz_code;
                    const plzText = data.results[0].plz_name_long;

                    // –í—ã–±–∏—Ä–∞–µ–º PLZ —á–µ—Ä–µ–∑ Select2 API
                    $('#id_postal_code').val(plzCode).trigger('change').addClass('is-valid');
                    showToast(`PLZ ${plzCode} automatisch ausgew√§hlt`, 'success', 3000);
                }

                $('#id_city').addClass('is-valid');
            } else {
                showToast('Keine PLZ f√ºr diese Stadt gefunden', 'warning');
                $('#id_city').removeClass('is-valid');
            }
        })
        .catch(error => {
            console.error('Fehler bei PLZ-Suche:', error);
            showToast('Fehler beim Suchen der PLZ', 'error');
        });
}

function handleCityClear() {
    console.log('üóëÔ∏è Stadt gel√∂scht - PLZ wird zur√ºckgesetzt');

    // –û—á–∏—â–∞–µ–º PLZ
    $('#id_postal_code').val(null).trigger('change').removeClass('is-valid is-invalid');
    $('#id_city').removeClass('is-valid is-invalid');
    $('#plz-results').hide();

    // –í–ê–ñ–ù–û: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º AJAX —Ä–µ–∂–∏–º –¥–ª—è PLZ
    restoreAllPlzOptions();
}

function closeModal() {
    if (confirm('M√∂chten Sie das Fenster schlie√üen? Ungesicherte √Ñnderungen gehen verloren.')) {
        window.location.href = '/';
    }
}
</script>

<script src="{% static 'js/register_company_step3.js' %}"></script>
{% endblock %}